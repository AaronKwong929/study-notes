# Node 的事件循环

```
   ┌───────────────────────────┐
┌─>│           timers          │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │     pending callbacks     │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
│  │       idle, prepare       │
│  └─────────────┬─────────────┘      ┌───────────────┐
│  ┌─────────────┴─────────────┐      │   incoming:   │
│  │           poll            │<─────┤  connections, │
│  └─────────────┬─────────────┘      │   data, etc.  │
│  ┌─────────────┴─────────────┐      └───────────────┘
│  │           check           │
│  └─────────────┬─────────────┘
│  ┌─────────────┴─────────────┐
└──┤      close callbacks      │
   └───────────────────────────┘
```

`timers`: 执行由 `setTimeout` 和 `setInterval` 设置的回调

`pending callbacks`: 执行推迟到下一个循环迭代的 `I/O` 回调

`idle,prepare`: 内部使用，不需关心

`poll`: 取出新完成的 `I/O` 事件，执行和 `I/O` 相关的回调

`check`: `setImmediate` 回调

`close callbacks`: 关闭回调，`socket.on('close', () => {})`等

## 各阶段细节

### timers

设置的时间不是准确执行时间，指经过指定时间后尽早运行

