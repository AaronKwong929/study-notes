# HTTPS

## 基本概念

使用 Secure Socket Layer(ssl) 或者 Transport Layer Security(TLS) 加密通信内容

SSL3.0（已弃用），TLS1.2（主流使用）

功能实现依靠：`非对称加密`, `对称加密`, `散列算法`

SSL 在应用层（表示层 - 算 7 层的话）

## HTTPS 请求

1. 客户端请求 https 站点

2. 服务端返回公钥证书(B 发送 `B公`回到 A)

3. 客户端验证公钥证书(数字证书)

   - 3.1. 失败：弹出警告

   - 3.2. 成功：伪随机数生成会话密钥，使用 `B公` 加密会话密钥，发送给服务端

4. 服务端用 `B私`解密，获得 `A私`

5. 然后服务端使用 `A私`，对称加密报文，发送给 A

6. A 也用 `A私` 进行解密

## HTTP 和 HTTPS 对比

|          |  HTTP  |               HTTPS                |
| :------: | :----: | :--------------------------------: |
|   端口   |   80   |                443                 |
|   特点   | 单元格 | 更安全，利于 SEO，有站点安全锁提示 |
| OSI 7 层 | 传输层 |               表示层               |
|   4 层   | 传输层 |               应用层               |
|   成本   |   低   |       高(证书选择/购买/部署)       |

## 握手过程 基于 tcp 三次再额外加 4 次

1. 建立安全能力：协议版本，会话 ID，密码构建，压缩方法，随机数

2. 服务器发送证书，密钥交换，证书请求，发送请求（和响应阶段结束信号

3. 如果有证书请求客户端发送此证书 之后客户端发送密钥交换数据 也可以发送证书验证消息

4. 变更密码构件和结束握手协议

## 数字证书

- 向 CA 申请证书

  - 网站准备公钥/私钥，私钥备用

  - 向 CA 提交公钥、公司、站点信息

  - CA 验证提供信息的真实性

  - 通过审核后 CA 办法数字证书 - 包含公钥，组织信息，CA 信息，有效时间，证书序号（均明文），同时还有一个 CA 生成的签名

CA 使用 Hash 函数来计算极客时间提交的明文，得出消息摘要，然后 CA 使用自身私钥加密消息摘要 ==> 这个密文就是 CA 颁发给网站的签名

## 浏览器验证数字证书

浏览器向服务器发出请求，服务器返回数字证书给浏览器

获取证书明文信息，采用 CA 同款 Hash 函数计算，得到`消息摘要A`

用 CA 的公钥进行解密得到`消息摘要B`

比对一致 => 证书合法(消息非发送自中间人，未经篡改)

相当于校验了 CA 是谁，如果 CA 小众，那么浏览器要去查找给这个 CA 发布证书的 CA 一路向上找如果找不到浏览器内置的顶级 CA ==> 证书非法

## HTTPS 为什么采用非对称和对称加密方式组合

在交换密钥阶段采用非对称加密，认证成功后使用通话密钥对称加密

对称加密是位运算，速度快

非对称加密例如`RSA`涉及到大数乘法、大数模

一言蔽之：在相互确认安全的情况下不再需要非对称加密了。
